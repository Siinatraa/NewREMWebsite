import { Skull, FileSearch, AlertTriangle, ChevronDown, ChevronRight } from 'lucide-react';
import { useState } from 'react';

export function RealMalwarePage() {
  const [expandedWriteups, setExpandedWriteups] = useState<string[]>([]);

  const toggleWriteup = (writeup: string) => {
    setExpandedWriteups(prev => 
      prev.includes(writeup) 
        ? prev.filter(w => w !== writeup)
        : [...prev, writeup]
    );
  };

  return (
    <div className="content-wrapper py-12">
      <div className="max-w-4xl mx-auto">
        {/* Header */}
        <div className="text-center mb-12 animate-fade-in">
          <div className="inline-flex items-center justify-center w-16 h-16 rounded-lg bg-gradient-to-br from-destructive/20 to-destructive/5 mb-6">
            <Skull className="w-8 h-8 text-destructive" />
          </div>
          <h1 className="glow-text mb-4">Real Malware Analysis</h1>
          <p className="text-muted-foreground max-w-2xl mx-auto">
            In-depth analysis of legitimate malware samples, dissecting behavior and attack vectors
          </p>
        </div>

        {/* Warning Banner */}
        <div className="bg-destructive/10 border border-destructive/30 rounded-lg p-6 mb-8 animate-fade-in" style={{ animationDelay: '100ms' }}>
          <div className="flex items-start gap-3">
            <AlertTriangle className="w-6 h-6 text-destructive flex-shrink-0 mt-0.5" />
            <div>
              <h3 className="text-lg font-semibold text-destructive mb-2">Important Notice</h3>
              <p className="text-foreground/80 text-sm">
                All malware analysis is conducted in controlled, isolated environments. 
                Never attempt to analyze malware on production systems or without proper 
                security measures and authorization.
              </p>
            </div>
          </div>
        </div>

        {/* Voldemort Write-up */}
        <div className="tech-card mb-6 animate-fade-in" style={{ animationDelay: '200ms' }}>
          <button
            onClick={() => toggleWriteup('voldemort')}
            className="w-full flex items-center justify-between text-left p-6 hover:bg-muted/30 transition-colors rounded-lg"
          >
            <div className="flex items-center gap-3">
              <span className="px-3 py-1 bg-destructive/20 text-destructive rounded-md text-sm font-semibold">MALWARE</span>
              <h2 className="text-2xl font-bold">Voldemort</h2>
            </div>
            {expandedWriteups.includes('voldemort') ? <ChevronDown className="w-6 h-6" /> : <ChevronRight className="w-6 h-6" />}
          </button>
          
          {expandedWriteups.includes('voldemort') && (
            <div className="px-6 pb-6 space-y-6">
              
              {/* Intro */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Intro</h3>
                <img src="/assets/voldemort/20.png" alt="Intro context" className="rounded-lg border border-border w-full" />
                <p className="text-foreground/80 leading-relaxed">
                  I had an idea since im getting my hands dirty in with Reverse Engineering, What if I write my own malware and reverse it? Well this is what I did, I fired up good ole Youtube and followed a tutorial on writing Ransomeware. I did it based on the video by Network Chuck called “I created Malware with Python”. He creates a python program called Voldemort.py to encryps his files.
                </p>
                <p className="text-foreground/80 leading-relaxed">
                  My main goal of this was to not completly reverse this with Behavioral/Dynamic Analysis but to get better with Code Analysis. Even though I know what this does as well as have the source code, I wanted to be able to break it down and Identify what it does via Ghidra. Now this was my Original plan but lack of research, planning, and prep it did not go that way at all. Due to how Python works and it being “compiled”, I simply can not examine the program logic behind this like other malware executables. When I made Voldemort.elf with pyinstaller it became what is called packed, this is due to it being an interperted language. When turning it into an executable it gets packed, this means it gets bundled with Python Runtime and a Python Byte Code Script, this acts a wrapper. When the elf is put into Ghidra it see this wrapper and not the script itself. Now this is different from compiled, other programs that gets compiled (like C or C++) gets translated into machine code. This doesn’t need a wrapper to help be read since the computer can natively read machine code. That is why you can add some executables directly into Ghidra to observe the programs logic. I did not figure this information out till I already wrote/compiled/and loaded it in Ghidra. My original plan of Code Analysis turned into straight up Static Analysis, not what I wanted but still I think its a cool project.
                </p>
              </div>

              {/* Video */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Video Description</h3>
                <p className="text-foreground/80 leading-relaxed">
                  In the video he goes and creates a basic Ransomeware program with python and to be honest it was incredibly simple with only 25 lines of code. Before I even watched the video it never occurred to me how simple a basic ransomeware program would be. You need basically two things, a way to grab the files and a way to encrypt them. In python you can use the import os library to allow the program to grab the files and the fernet library to encrypt them, set a couple variables and your good! I put a picture below of the code.
                </p>
                <img src="/assets/voldemort/21.png" alt="Python ransomware code" className="rounded-lg border border-border w-full" />
                <p className="text-foreground/80 leading-relaxed">
                  Now before we start reversing we need to make it an executable. Network Chuck made this for Linux Machines so we will make it a .elf, you can do with “pyinstaller -F Voldemort.py”. Side note about this, using the -F will pack it but based on what OS you’re using. If you’re on Windows it’ll make an exe, if you’re on linux it’ll be an .elf file. After doing this we get an executable called Voldemort.
                </p>
              </div>

              {/* Initial Analysis */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Initial Analysis</h3>
                <p className="text-foreground/80 leading-relaxed">
                  One of the first things I always like to do is run strings to find any interesting text in the executable. Going through we see some strings that relates it to python.
                </p>
                <img src="/assets/voldemort/22.png" alt="Strings output showing Python references" className="rounded-lg border border-border w-full" />
                <p className="text-foreground/80 leading-relaxed">
                  Running it through DIE we get some more informaton about the malware itself. We see its an elf as well it being written in Python which confirms our thoery from running strings. We also see it was packed using the Pyinstaller.
                </p>
                <img src="/assets/voldemort/23.png" alt="DIE analysis showing Python and PyInstaller" className="rounded-lg border border-border w-full" />
                <p className="text-foreground/80 leading-relaxed">
                  Also another way we can tell if its packed is by viewing the entropy. We can do this by clicking advanced → entropy. On a scale of 0 to 8 we see it is very very high indicating a packed executable. A 7.99 of 8
                </p>
                <img src="/assets/voldemort/24.png" alt="High entropy indication" className="rounded-lg border border-border w-full" />
                <p className="text-foreground/80 leading-relaxed">
                  With it being confirmed written in Python we can essentailly extract the orignal source code. We will use two tools, pyinstxtractor and uncompyle6. Pyinstxtractor will allow us to extract the Voldemort.pyc file. Using the command “python3 pyinstxtractor.py ~/Voldemort”
                </p>
                <img src="/assets/voldemort/25.png" alt="Extracting with pyinstxtractor" className="rounded-lg border border-border w-full" />
                <p className="text-foreground/80 leading-relaxed">
                  Once we get Voldemort.pyc we throw it into uncompyle6 to turn the bytecode into the orignal source code or atleast something very similar. Running the command “uncompyle6 /location/to/Voldemort.pyc” it give the exact code we wrote earlier!
                </p>
                <img src="/assets/voldemort/26.png" alt="Decompiled source code" className="rounded-lg border border-border w-full" />
              </div>

              {/* Conclusion */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Conclusion</h3>
                <p className="text-foreground/80 leading-relaxed">
                  Although this was not my orignal intent I still enjoyed it. I learned a good amount too, mainly to difference between compiled and interpreted languages. Also got a little crash course in how to reverse basic python based malware which was pretty cool. For next time I will make sure to create a compiled language malware so I can focus on mainly code analysis like my original goal was. Again still pretty cool and glad I did this
                </p>
              </div>

              {/* Close Button */}
              <div className="mt-8 flex justify-center">
                <button
                  onClick={() => toggleWriteup('voldemort')}
                  className="px-6 py-3 bg-destructive/20 hover:bg-destructive/30 text-destructive rounded-lg transition-colors font-semibold"
                >
                  Close Write-up
                </button>
              </div>

            </div>
          )}
        </div>

        {/* Information Card */}
        <div className="mt-8 bg-muted/30 rounded-lg p-6 border border-border animate-fade-in" style={{ animationDelay: '400ms' }}>
          <h3 className="text-lg font-semibold mb-3 text-destructive">What to Expect</h3>
          <ul className="space-y-2 text-foreground/80">
            <li className="flex items-start gap-2">
              <span className="text-destructive mt-1">▹</span>
              <span>Static and dynamic malware analysis techniques</span>
            </li>
            <li className="flex items-start gap-2">
              <span className="text-destructive mt-1">▹</span>
              <span>Behavioral analysis and payload extraction</span>
            </li>
            <li className="flex items-start gap-2">
              <span className="text-destructive mt-1">▹</span>
              <span>Network traffic analysis and C2 communication</span>
            </li>
            <li className="flex items-start gap-2">
              <span className="text-destructive mt-1">▹</span>
              <span>Indicators of Compromise (IOCs) and detection signatures</span>
            </li>
            <li className="flex items-start gap-2">
              <span className="text-destructive mt-1">▹</span>
              <span>Reverse engineering malware code and functionality</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  );
}
