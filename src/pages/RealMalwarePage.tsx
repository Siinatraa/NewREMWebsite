import { Skull, FileSearch, AlertTriangle, ChevronDown, ChevronRight } from 'lucide-react';
import { useState } from 'react';

export function RealMalwarePage() {
  const [expandedWriteups, setExpandedWriteups] = useState<string[]>([]);

  const toggleWriteup = (writeup: string) => {
    setExpandedWriteups(prev => 
      prev.includes(writeup) 
        ? prev.filter(w => w !== writeup)
        : [...prev, writeup]
    );
  };

  return (
    <div className="content-wrapper py-12">
      <div className="max-w-4xl mx-auto">
        {/* Header */}
        <div className="text-center mb-12 animate-fade-in">
          <div className="inline-flex items-center justify-center w-16 h-16 rounded-lg bg-gradient-to-br from-destructive/20 to-destructive/5 mb-6">
            <Skull className="w-8 h-8 text-destructive" />
          </div>
          <h1 className="glow-text mb-4">Real Malware Analysis</h1>
          <p className="text-muted-foreground max-w-2xl mx-auto">
            In-depth analysis of legitimate malware samples, dissecting behavior and attack vectors
          </p>
        </div>

        {/* Warning Banner */}
        <div className="bg-destructive/10 border border-destructive/30 rounded-lg p-6 mb-8 animate-fade-in" style={{ animationDelay: '100ms' }}>
          <div className="flex items-start gap-3">
            <AlertTriangle className="w-6 h-6 text-destructive flex-shrink-0 mt-0.5" />
            <div>
              <h3 className="text-lg font-semibold text-destructive mb-2">Important Notice</h3>
              <p className="text-foreground/80 text-sm">
                All malware analysis is conducted in controlled, isolated environments. 
                Never attempt to analyze malware on production systems or without proper 
                security measures and authorization.
              </p>
            </div>
          </div>
        </div>

        {/* Voldemort Write-up */}
        <div className="tech-card mb-6 animate-fade-in" style={{ animationDelay: '200ms' }}>
          <button
            onClick={() => toggleWriteup('voldemort')}
            className="w-full flex items-center justify-between text-left p-6 hover:bg-muted/30 transition-colors rounded-lg"
          >
            <div className="flex items-center gap-3">
              <span className="px-3 py-1 bg-destructive/20 text-destructive rounded-md text-sm font-semibold">MALWARE</span>
              <h2 className="text-2xl font-bold">Voldemort</h2>
            </div>
            {expandedWriteups.includes('voldemort') ? <ChevronDown className="w-6 h-6" /> : <ChevronRight className="w-6 h-6" />}
          </button>
          
          {expandedWriteups.includes('voldemort') && (
            <div className="px-6 pb-6 space-y-6">
              
              {/* Intro */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Intro</h3>
                <img src="/assets/voldemort/20.png" alt="Intro context" className="rounded-lg border border-border w-full" />
                <p className="text-foreground/80 leading-relaxed">
                  I had an idea since im getting my hands dirty in with Reverse Engineering, What if I write my own malware and reverse it? Well this is what I did, I fired up good ole Youtube and followed a tutorial on writing Ransomeware. I did it based on the video by Network Chuck called “I created Malware with Python”. He creates a python program called Voldemort.py to encryps his files.
                </p>
                <p className="text-foreground/80 leading-relaxed">
                  My main goal of this was to not completly reverse this with Behavioral/Dynamic Analysis but to get better with Code Analysis. Even though I know what this does as well as have the source code, I wanted to be able to break it down and Identify what it does via Ghidra. Now this was my Original plan but lack of research, planning, and prep it did not go that way at all. Due to how Python works and it being “compiled”, I simply can not examine the program logic behind this like other malware executables. When I made Voldemort.elf with pyinstaller it became what is called packed, this is due to it being an interperted language. When turning it into an executable it gets packed, this means it gets bundled with Python Runtime and a Python Byte Code Script, this acts a wrapper. When the elf is put into Ghidra it see this wrapper and not the script itself. Now this is different from compiled, other programs that gets compiled (like C or C++) gets translated into machine code. This doesn’t need a wrapper to help be read since the computer can natively read machine code. That is why you can add some executables directly into Ghidra to observe the programs logic. I did not figure this information out till I already wrote/compiled/and loaded it in Ghidra. My original plan of Code Analysis turned into straight up Static Analysis, not what I wanted but still I think its a cool project.
                </p>
              </div>

              {/* Video */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Video Description</h3>
                <p className="text-foreground/80 leading-relaxed">
                  In the video he goes and creates a basic Ransomeware program with python and to be honest it was incredibly simple with only 25 lines of code. Before I even watched the video it never occurred to me how simple a basic ransomeware program would be. You need basically two things, a way to grab the files and a way to encrypt them. In python you can use the import os library to allow the program to grab the files and the fernet library to encrypt them, set a couple variables and your good! I put a picture below of the code.
                </p>
                <img src="/assets/voldemort/21.png" alt="Python ransomware code" className="rounded-lg border border-border w-full" />
                <p className="text-foreground/80 leading-relaxed">
                  Now before we start reversing we need to make it an executable. Network Chuck made this for Linux Machines so we will make it a .elf, you can do with “pyinstaller -F Voldemort.py”. Side note about this, using the -F will pack it but based on what OS you’re using. If you’re on Windows it’ll make an exe, if you’re on linux it’ll be an .elf file. After doing this we get an executable called Voldemort.
                </p>
              </div>

              {/* Initial Analysis */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Initial Analysis</h3>
                <p className="text-foreground/80 leading-relaxed">
                  One of the first things I always like to do is run strings to find any interesting text in the executable. Going through we see some strings that relates it to python.
                </p>
                <img src="/assets/voldemort/22.png" alt="Strings output showing Python references" className="rounded-lg border border-border w-full" />
                <p className="text-foreground/80 leading-relaxed">
                  Running it through DIE we get some more informaton about the malware itself. We see its an elf as well it being written in Python which confirms our thoery from running strings. We also see it was packed using the Pyinstaller.
                </p>
                <img src="/assets/voldemort/23.png" alt="DIE analysis showing Python and PyInstaller" className="rounded-lg border border-border w-full" />
                <p className="text-foreground/80 leading-relaxed">
                  Also another way we can tell if its packed is by viewing the entropy. We can do this by clicking advanced → entropy. On a scale of 0 to 8 we see it is very very high indicating a packed executable. A 7.99 of 8
                </p>
                <img src="/assets/voldemort/24.png" alt="High entropy indication" className="rounded-lg border border-border w-full" />
                <p className="text-foreground/80 leading-relaxed">
                  With it being confirmed written in Python we can essentailly extract the orignal source code. We will use two tools, pyinstxtractor and uncompyle6. Pyinstxtractor will allow us to extract the Voldemort.pyc file. Using the command “python3 pyinstxtractor.py ~/Voldemort”
                </p>
                <img src="/assets/voldemort/25.png" alt="Extracting with pyinstxtractor" className="rounded-lg border border-border w-full" />
                <p className="text-foreground/80 leading-relaxed">
                  Once we get Voldemort.pyc we throw it into uncompyle6 to turn the bytecode into the orignal source code or atleast something very similar. Running the command “uncompyle6 /location/to/Voldemort.pyc” it give the exact code we wrote earlier!
                </p>
                <img src="/assets/voldemort/26.png" alt="Decompiled source code" className="rounded-lg border border-border w-full" />
              </div>

              {/* Conclusion */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Conclusion</h3>
                <p className="text-foreground/80 leading-relaxed">
                  Although this was not my orignal intent I still enjoyed it. I learned a good amount too, mainly to difference between compiled and interpreted languages. Also got a little crash course in how to reverse basic python based malware which was pretty cool. For next time I will make sure to create a compiled language malware so I can focus on mainly code analysis like my original goal was. Again still pretty cool and glad I did this
                </p>
              </div>

              {/* Close Button */}
              <div className="mt-8 flex justify-center">
                <button
                  onClick={() => toggleWriteup('voldemort')}
                  className="px-6 py-3 bg-destructive/20 hover:bg-destructive/30 text-destructive rounded-lg transition-colors font-semibold"
                >
                  Close Write-up
                </button>
              </div>

            </div>
          )}
        </div>

        {/* QuasarRAT with Amadey Write-up */}
        <div className="tech-card mb-6 animate-fade-in" style={{ animationDelay: '300ms' }}>
          <button
            onClick={() => toggleWriteup('quasarrat')}
            className="w-full flex items-center justify-between text-left p-6 hover:bg-muted/30 transition-colors rounded-lg"
          >
            <div className="flex items-center gap-3">
              <span className="px-3 py-1 bg-destructive/20 text-destructive rounded-md text-sm font-semibold">MALWARE</span>
              <h2 className="text-2xl font-bold">QuasarRAT with Amadey</h2>
            </div>
            {expandedWriteups.includes('quasarrat') ? <ChevronDown className="w-6 h-6" /> : <ChevronRight className="w-6 h-6" />}
          </button>

          {expandedWriteups.includes('quasarrat') && (
            <div className="px-6 pb-6 space-y-6">

              {/* Intro */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Intro</h3>
                <div className="p-4 bg-muted/50 rounded-lg border border-border">
                  <p className="font-mono text-sm break-all">
                    <span className="text-destructive font-semibold">SHA256 Hash:</span> 28238e69acbc003e13763993c7668cc415a65c15a8ed207d860462ef0f3c70da
                  </p>
                </div>
                <p className="text-foreground/80 leading-relaxed">
                  This was pulled off of Malware Bazaar and it caught my eye as it mentioned Quasar RAT. Cool name right? Now I’ve heard the name before but didn’t know to much about it so I did some research and it has an interesting history. So Quasar (without the RAT) is a legitimate open source windows remoting tool. It was first released in 2014 but since then threat actors including APTs have utilized this software for malicious purposes. It is written in C# and .NET and has a good amount of capabilities with the most obvious one of remote access.
                </p>
                <p className="text-foreground/80 leading-relaxed">
                  On to Amadey, this is credential stealer which focuses on taking Browser and Crypto Currency Credentials for financial gain. it does extensive fingerprinting of the victims machine and does all of this with specific plugins to make it easier.
                </p>
              </div>

              {/* Static Analysis */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Static Analysis</h3>
                <p className="text-foreground/80 leading-relaxed">
                  The first thing ill always do first is throw it in DIE or Detect It Easy to show us what and how it was compiled. Doing our research before we already knew it was .NET and in C# and seeing it here is no surprise. Now there are several things id like to break down that gives us hints on what to do next. We see it is obfuscated and packed which is common with .NET Malware, it also mentioned Debug Data which would make it harder for us to analyze it later. We can use a tool called “de4dot” which will attempt to Deobfuscate and possibly give us back the source code, with it using the Costura Fody Library I might have to use another tool as this specifically embeds all dependency DLLs and compresses with them. With the combination of Anti Debugging in this it could be difficult so hopefully De4dot will get it on the first go round.
                </p>
                <img src="/assets/quasarrat/00-static-die.png" alt="Static Analysis with DIE" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  Now after this initial analysis I ran it through De4dot and got the “cleaned” executable. I put both the cleaned and the original executable in PeStudio to see what the difference was. After looking through it they appear to be the same so lets go through the our findings. First thing we notice is clear time stomping.
                </p>
                <img src="/assets/quasarrat/01-timestomping.png" alt="Time stomping analysis" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  In this screenshot below we see the entropy of different directories, it is almost an 8 in the .text which means it obfuscated/packed
                </p>
                <img src="/assets/quasarrat/02-entropy.png" alt="Entropy analysis" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  Now we get the original file name! It seems to be a trojanized version of ChromeSetup.exe, in the second screenshot we see the working directory of the creation of the file.
                  <br/>
                  <span className="text-sm italic">Side Note: Just out of curiosity I looked up the version of Google Chrome and it was released Dec 10th 2024.</span>
                </p>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <img src="/assets/quasarrat/03-original-filename.png" alt="Original filename" className="rounded-lg border border-border w-full" />
                  <img src="/assets/quasarrat/04-chrome-version.png" alt="Chrome version" className="rounded-lg border border-border w-full" />
                </div>

                <p className="text-foreground/80 leading-relaxed">
                  Now pulling the strings we get some really interesting ones and good picture of the purpose of this malware.
                  <br/>
                  1. The first screenshot seems to add or manipulate something with a bunch of different browsers
                </p>
                <img src="/assets/quasarrat/05-strings-browsers.png" alt="Browser strings" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  It seems to target the users crypto currency wallet
                </p>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <img src="/assets/quasarrat/06-strings-crypto.png" alt="Crypto strings 1" className="rounded-lg border border-border w-full" />
                  <img src="/assets/quasarrat/07-strings-crypto-2.png" alt="Crypto strings 2" className="rounded-lg border border-border w-full" />
                </div>

                <p className="text-foreground/80 leading-relaxed">
                  My favorite of the strings screenshots, this shows C2, Persistence, and possible priv esc
                </p>
                <img src="/assets/quasarrat/08-strings-c2.png" alt="C2 strings" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  Now I was curious about the IPs and did some research about it, apparently it’s (149) is a telegram server. Its owned by Nikalai Durov located in the British Virgin Islands according to the Whois website but doing further research into the man himself that is just the guy who created Telegram. Damn I thought I was on to something! Looking at the other IP and conducting some OSINT on it ive found it be hosting the domain “previzao[.]com” and “suporte2.mxpteempredimentos[.]com”. The first domain is legitimate, viewing the background noise via burp suite saw nothing malicious or even tracking being loaded, its there in the DNS record to through analyst off. I also noticed when resolved previzao goes to another IP Address not the 192 above. Now the supporte2 address does resolve to the 192 address. Interestingly as well this website was registered on 12 of Dec 2025 and with compilation date of the malware, this probably an on going cyber crime campaign.
                </p>
                <img src="/assets/quasarrat/09-domain-info.png" alt="Domain OSINT" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  Going back and doing a Whois on the 192 IP we see the description being a long encrypted string. This is very common for bulletproof hosting providers, if you dont know what they do they on purposely ignore abuse complaints, takedowns, etc… and are common for hosting Malicious Actors
                </p>
                <img src="/assets/quasarrat/10-whois.png" alt="Whois info" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  All that being found I wanted to put the executable in Capa before we move to our next step in the analysis.
                </p>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <img src="/assets/quasarrat/11-capa-1.png" alt="Capa analysis 1" className="rounded-lg border border-border w-full" />
                  <img src="/assets/quasarrat/12-capa-2.png" alt="Capa analysis 2" className="rounded-lg border border-border w-full" />
                </div>
                <p className="text-foreground/80 leading-relaxed">
                  Viewing the above screenshot it shows pretty much what I figured through looking at the strings.
                </p>
              </div>

              {/* Code Analysis : Enumeration */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Code Analysis : Enumeration</h3>
                <p className="text-foreground/80 leading-relaxed">
                  Loading it into Ghidra our De4dot worked pretty well but not good enough, It gave us the custom function names but did not deobfuscate the code. What were seeing Ghidra is the CIL Bytecode of the executable which makes it a garbled mess for us to fix. There is another tool just for this job, DnSpy. Combining these two tools together we can get a better look into the code itself. DnSpy will turn the CIL Byte code back into the C# Code we need.
                </p>
                <img src="/assets/quasarrat/13-dnspy.png" alt="DnSpy analysis" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  Starting at the beginning with Chrome_v20_Decryptor_CSharp in the subtab Chromium, the first part we see is it searching for these chrome based browser attempting to see which one you have downloaded on your computer. It checks the LocalAppData and AppData Directories to see which browser you have installed. Interestingly enough it targets Yandex (which we found the string of before) which means whoever created this malware is NOT Russian. Russians are know to not attack other Russians as they’re can be severe penalties if found out, just a little tidbit.
                </p>
                <img src="/assets/quasarrat/14-yandex.png" alt="Yandex targeting" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  After it finds your browsers it references its “Dictionary” with where everything could possible be located and then creates a new dictionary based on your system so it can be referenced later in the malware.
                </p>
                <img src="/assets/quasarrat/15-dictionary.png" alt="Dictionary creation" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  Another interesting part to this is that it does target just your user account, it targets as many as possible so if your share your family computer (or have hidden accounts) it will attempt to grab their browser information as well.
                </p>
                <img src="/assets/quasarrat/16-user-accounts.png" alt="User account targeting" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  Now that it has found your browsers name we go into the next part of the software. It will kill your current browser session if it is open. It will wait 3 seconds for it to fully be closed and then every 1 seconds checks to see if its running just to kill it again.
                </p>
                <img src="/assets/quasarrat/17-kill-browser.png" alt="Browser kill switch" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  Jumping to the Master Key block we find several hardcoded AES-GCM/ChaCha20 keys used by various Chromium browser. These keys are apart of the cryptographic function in your browser. What we see in the code are the Universal Master keys (in the screenshot) to unlock your current Browser Encryption Keys (that are unique to you) so they can access the plaintext version of your important browser information.
                </p>
                <img src="/assets/quasarrat/18-master-keys.png" alt="Master keys" className="rounded-lg border border-border w-full" />
              </div>

              {/* Code Analysis : Priv Esc */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Code Analysis : Priv Esc</h3>
                <p className="text-foreground/80 leading-relaxed">
                  Now working in the same blob at the very bottom we see it attempt to impersonate LSASS to get decrypt your unique browser key. Assuming you’re someone who wanted to download or update chrome it would ask for Admin Permissions to do its thing which is valid, Google Chrome does prompt a UAC when downloading it. Since you gave it admin privs already its able to impersonate the LSASS and this is our first priv esc vector in this malware. Now you might be asking what's the difference between giving it your Admin Privs vs LSASS’s Priv. I looked into it as I was a little confused too. Being an Admin is great an all but it gives you access to only all the User Data you could want, well in order to get these decryption keys you need to access the System Data. In Windows it will not allow you to touch them because you are considered a User even with Admin Privs so it needs to escalate to non user account with Admin Privs. Impersonating LSASS in Windows will allow you to do this.
                </p>
                <img src="/assets/quasarrat/19-impersonate-lsass.png" alt="Impersonating LSASS" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  Now after this we see it make a call to DuplicateTokenEx giving itself, the malware, the same perms as the LSASS Process.
                </p>
                <img src="/assets/quasarrat/20-duplicate-token.png" alt="DuplicateTokenEx" className="rounded-lg border border-border w-full" />
              </div>

              {/* Code Analysis : Post Exploitation */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Code Analysis : Post Exploitation</h3>
                <p className="text-foreground/80 leading-relaxed">
                  After it gets its LSASS Token it begins to start stealing information as by looking at the Assembly Explorer names for Chromium Based Browsers. After this there is a section for Firefox as well which follows the same Kill, Grab keys, steal info etc… as before
                </p>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <img src="/assets/quasarrat/21-browser-stealing-1.png" alt="Browser stealing 1" className="rounded-lg border border-border w-full" />
                  <img src="/assets/quasarrat/22-browser-stealing-2.png" alt="Browser stealing 2" className="rounded-lg border border-border w-full" />
                </div>

                <p className="text-foreground/80 leading-relaxed">
                  Now that it has your Browser Decryption Key it can now grab what ever it wants.
                </p>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <img src="/assets/quasarrat/23-grab-keys-1.png" alt="Grabbing keys 1" className="rounded-lg border border-border w-full" />
                  <img src="/assets/quasarrat/24-grab-keys-2.png" alt="Grabbing keys 2" className="rounded-lg border border-border w-full" />
                </div>

                <p className="text-foreground/80 leading-relaxed">
                  Were not done yet! After grabbing your credit card information and all your usernames/passwords it checks to see if you have any Crypto Currency Wallets!
                </p>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <img src="/assets/quasarrat/25-crypto-wallets-1.png" alt="Crypto wallets 1" className="rounded-lg border border-border w-full" />
                  <img src="/assets/quasarrat/26-crypto-wallets-2.png" alt="Crypto wallets 2" className="rounded-lg border border-border w-full" />
                </div>

                <p className="text-foreground/80 leading-relaxed">
                  It will search for any directories with “wallets” and inside of them check for several common extensions that are normally associated with crypto wallets. It will also enumerate your system for where other common crypto providers put their directories at and their extensions.
                </p>
              </div>

              {/* Code Analysis : Staging and Exfil via C2 */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Code Analysis : Staging and Exfil via C2</h3>
                <p className="text-foreground/80 leading-relaxed">
                  Now that its done having its way with your Browser Data it moves on to the Staging and Exfiltration stage and this where we find our C2! We see the url “http[:]//192.109.11.172:5555/upload” and several Telegram IP’s, 2 of which weren't found before! To obfuscate itself a little bit it creates a marker file, “.~msvc_cache.dat”, which checks to see if its already been hit by this malware before so its not resending the data over and over. This is a critical IOC to know if you were infected by this Info Stealer.
                </p>
                <img src="/assets/quasarrat/27-c2-url.png" alt="C2 URL" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  Looking through the names I see “SendPhoneHome”, custom name created by the author. This basically builds a unique id for your computer and then “pings” it with an HTTP request as seen in the very last line.
                </p>
                <img src="/assets/quasarrat/28-sendphonehome.png" alt="SendPhoneHome" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  Examining further in the code it Zips up a lot of information in preparation of exfilling the data found. Now there are 2 Different Zip Files it makes, a “SmallZip” and “ZipFolder”. In the Small Zip it gets key information, essentially takes the money and run with other important credentials. It targets Telegram, Discord and several common Password Managers
                </p>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <img src="/assets/quasarrat/29-smallzip-1.png" alt="SmallZip 1" className="rounded-lg border border-border w-full" />
                  <img src="/assets/quasarrat/30-smallzip-2.png" alt="SmallZip 2" className="rounded-lg border border-border w-full" />
                </div>

                <p className="text-foreground/80 leading-relaxed">
                  In the bigger “ZipFolder” this cleans the house out. It takes everything, including another copy of the “SmallZip”, as well as other data/files it found crawling your computer. This includes a full fingerprints of your system, crypto wallets, all your cookies, download history, etc….
                </p>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <img src="/assets/quasarrat/31-zipfolder-1.png" alt="ZipFolder 1" className="rounded-lg border border-border w-full" />
                  <img src="/assets/quasarrat/32-zipfolder-2.png" alt="ZipFolder 2" className="rounded-lg border border-border w-full" />
                </div>
                <img src="/assets/quasarrat/33-zipfolder-3.png" alt="ZipFolder 3" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  While it steals the credentials we also find the naming convention of the files before they are put in the zip file.
                </p>
                <img src="/assets/quasarrat/34-naming-convention.png" alt="File naming convention" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  In the screenshot below we also find the hardcoded naming convention for the Zip file as well.
                </p>
                <img src="/assets/quasarrat/35-zip-name.png" alt="Zip naming convention" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  After it zips up everything and sends it off to the designated C2 it deletes the Zip folder it created so there is less evidence of an Intrusion. It sleeps for 1 seconds and tries again, remember it creates 2 zip folders that's why its constantly checks.
                </p>
                <img src="/assets/quasarrat/36-delete-zip.png" alt="Deleting zip" className="rounded-lg border border-border w-full" />
              </div>

              {/* Dynamic Analysis : Setting the Stage */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">Dynamic Analysis : Setting the Stage</h3>
                <p className="text-foreground/80 leading-relaxed">
                  So I wanted to set up a couple things based on what we have found above, namely some Honey files so when we debug we can see it actually work in real time. I have created several files
                  <br/>
                  1. Create a fake browser database
                  <br/>
                  2. Create an empty Password Manager directory
                  <br/>
                  3. Create other honey files like passwords.txt
                </p>
                <p className="text-foreground/80 leading-relaxed">
                  Now it does have some Anti Debuggering capabilities which did make this a little annoying. The first mechanism was Scylla was able to beat but there was a kill switch after the execution I have to figure out how to bypass now. Well after an 2 hours of trying it checks if you’re in a VM eight times one after another. I had to Null out the the value to get past the second check but I honestly think the Antidebugging is above my head on this one. I cannot get seem to get it work after this. Im just gonna move to pure dynamic analysis instead dynamic code analysis while still utilizing the honeyfiles.
                </p>
                <img src="/assets/quasarrat/37-anti-debugging.png" alt="Anti-debugging" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  So Im gonna set several things up, on my Remnux machine im going to set up wireshark and INetSim along with on my windows machine Regshot and Process Monitor to see what was accessed.
                </p>
                <p className="text-foreground/80 leading-relaxed">
                  So taking the Process Monitor output into ProDOT we can see everything the process QuasarRAT.exe has done and sure enough it did its thing.
                </p>
                <img src="/assets/quasarrat/38-prodot.png" alt="ProDOT analysis" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  Even created the 2 Zip files with the Naming convention we found earlier and it seems to have taken my fake creds I made earlier with my browser keys too.
                </p>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <img src="/assets/quasarrat/39-zip-creation-1.png" alt="Zip creation 1" className="rounded-lg border border-border w-full" />
                  <img src="/assets/quasarrat/40-zip-creation-2.png" alt="Zip creation 2" className="rounded-lg border border-border w-full" />
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <img src="/assets/quasarrat/41-zip-creation-3.png" alt="Zip creation 3" className="rounded-lg border border-border w-full" />
                  <img src="/assets/quasarrat/42-zip-creation-4.png" alt="Zip creation 4" className="rounded-lg border border-border w-full" />
                </div>

                <p className="text-foreground/80 leading-relaxed">
                  Going to our Wireshark Capture we see the Ping to the IP to see if its still up but due to it being an Isolated Environment of course it doesn’t respond back
                </p>
                <img src="/assets/quasarrat/43-wireshark.png" alt="Wireshark capture" className="rounded-lg border border-border w-full" />

                <p className="text-foreground/80 leading-relaxed">
                  After detonating it interesting enough I checked the event viewer remembering it wanted to access the LSASS from impersonation, I couldn’t find anything.
                </p>
              </div>

              {/* What I learned */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-primary">What I learned</h3>
                <p className="text-foreground/80 leading-relaxed">
                  This was my first exposure to .NET malware and so the tools were all new to me. I learned a good amount of deobfuscating with it as well and got some practice going against anti debugging. The tools DnSpy and De4dot were pretty cool to use in conjunction together, I know if I see anything like this in the future ill know exactly what to do now. On top of that I also learned how to wipe out strings from memory via x32/64 debugger, if you recall it would check for these strings to see if im in a VM. That was a pretty cool thing to figure out how to do just by inserting the null bytes in the strings it called for the Anti Debugging Verification. Also another getting a real low level look into Amadey Malware I enjoyed that a lot. Dynamically executing it and going through my file system looking for the IOCs I found during the Code Analysis was also a nice finisher getting to see my analysis being spot on (most of it anyway). Overall this was pretty fun due to it still being an active C2 and being relatively recent from the time of writing this.
                </p>
              </div>

              {/* Close Button */}
              <div className="mt-8 flex justify-center">
                <button
                  onClick={() => toggleWriteup('quasarrat')}
                  className="px-6 py-3 bg-destructive/20 hover:bg-destructive/30 text-destructive rounded-lg transition-colors font-semibold"
                >
                  Close Write-up
                </button>
              </div>

            </div>
          )}
        </div>

        {/* Information Card */}
        <div className="mt-8 bg-muted/30 rounded-lg p-6 border border-border animate-fade-in" style={{ animationDelay: '400ms' }}>
          <h3 className="text-lg font-semibold mb-3 text-destructive">What to Expect</h3>
          <ul className="space-y-2 text-foreground/80">
            <li className="flex items-start gap-2">
              <span className="text-destructive mt-1">▹</span>
              <span>Static and dynamic malware analysis techniques</span>
            </li>
            <li className="flex items-start gap-2">
              <span className="text-destructive mt-1">▹</span>
              <span>Behavioral analysis and payload extraction</span>
            </li>
            <li className="flex items-start gap-2">
              <span className="text-destructive mt-1">▹</span>
              <span>Network traffic analysis and C2 communication</span>
            </li>
            <li className="flex items-start gap-2">
              <span className="text-destructive mt-1">▹</span>
              <span>Indicators of Compromise (IOCs) and detection signatures</span>
            </li>
            <li className="flex items-start gap-2">
              <span className="text-destructive mt-1">▹</span>
              <span>Reverse engineering malware code and functionality</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  );
}
